<mat-card class="row mb-3">
  <mat-card-header>
    <mat-card-title>Import your TSM addon history</mat-card-title>
    <mat-card-subtitle>
      <strong>Locate: </strong>
      <em>
        World of Warcraft/_retail_/WTF/Account/"account name"/SavedVariables/TradeSkillMaster.lua
      </em>
    </mat-card-subtitle>
    <mat-card-subtitle>
      <strong>Last updated:</strong> {{ lastModified | date: 'dd.MMM yyyy HH:mm:ss' }}
    </mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    To update the data, do /reload in-game and import the file again.
    The data is stored in your browser, but you will need to manually update it.
  </mat-card-content>
  <mat-card-actions>
    <button mat-button (click)="fileInput.click()">
      <i class="fas fa-upload"></i>
      Import "TradeSkillMaster.lua"
      <input class="d-none"
             type="file"
             accept="lua"
             (change)="importFromFile($event)"
             #fileInput/>
    </button>
  </mat-card-actions>
</mat-card>

<div *ngIf="tsmAddonData?.characterGuilds && !importMode">
  <mat-tab-group>
    <mat-tab label="Summary">
      <form [formGroup]="form">
        <mat-form-field>
          <mat-select placeholder="Realm" formControlName="realm">
            <mat-option *ngFor="let realm of realms" [value]="realm">
              {{ realm }}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </form>
      <wah-profit-summary *ngIf="selectedSet"
                          [realm]="form.value.realm"></wah-profit-summary>
    </mat-tab>
    <mat-tab label="Datasets">
      <form [formGroup]="form">
        <mat-form-field>
          <mat-select placeholder="Dataset" formControlName="dataset">
            <mat-option *ngFor="let set of dataSets; let i = index" [value]="i">
              {{ set.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-select placeholder="Realm" formControlName="realm">
            <mat-option *ngFor="let realm of realms" [value]="realm">
              {{ realm }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field *ngIf="selectedSet?.hasCharacters">
          <mat-select placeholder="Character" formControlName="character">
            <mat-option *ngFor="let name of characters" [value]="name">
              {{ name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </form>
      <div *ngIf="selectedSet">

        <wah-data-table
                id="id"
                [iconSize]="22"
                [itemsPerPage]="40"
                filterParameter="name"
                [columns]="table.columns"
                [data]="table.data"></wah-data-table>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>